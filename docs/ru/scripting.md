# Скриптинг

Игровой движок BYOND 2.0 предлагает полиглотную среду для написания скриптов, позволяя разработчикам использовать несколько языков для определения игровой логики. Основными поддерживаемыми языками являются **DM (Dream Maker)**, **Lua** и **C#**.

## DM (Dream Maker)

DM — это нативный язык платформы BYOND и рекомендуемый выбор для большей части игровой логики в BYOND 2.0. Движок включает в себя компилятор OpenDream, который компилирует файлы `.dme` и `.dm` в байткод, исполняемый `DreamVM`.

*   **Исполнение:** Код DM выполняется высокопроизводительной `DreamVM`, стековой виртуальной машиной.
*   **Точка входа:** Основной точкой входа для всей игровой логики является процедура `world.New()` в вашем DM-коде.

### Пример DM

```dm
// main.dm
/world/New()
    // Загрузка карты
    world.log << "Loading map..."
    // Дальнейший код инициализации

/obj/creature/player
    var/hp = 100

    proc/TakeDamage(amount)
        hp -= amount
        if (hp <= 0)
            del src
```

## Lua

Lua предоставляет легковесный и гибкий вариант для написания скриптов. Он хорошо подходит для быстрого прототипирования или для специфических задач, которые выигрывают от его динамической природы.

*   **Интеграция:** Lua интегрирована с помощью библиотеки NLua, которая обеспечивает мост к среде выполнения .NET.
*   **Доступ к API:** Скрипты Lua могут получать доступ к основным API движка через глобальный объект `GameApi`.
*   **Точка входа:** Точкой входа для Lua является файл `scripts/main.lua`.

### Пример Lua API

```lua
-- scripts/main.lua
local mapApi = global.GameApi.MapApi
local objectApi = global.GameApi.ObjectApi

-- Создать новый объект
local player = objectApi:CreateObject("/obj/creature/player")
player:SetProperty("x", 10)
player:SetProperty("y", 5)
```

## C#

Скриптинг на C# предлагает высочайшую производительность и всю мощь экосистемы .NET. Он идеален для критически важных с точки зрения производительности систем или для расширения движка сложной, статически типизированной логикой.

*   **Интеграция:** Скрипты C# компилируются "на лету" с помощью Roslyn.
*   **Доступ к API:** Скрипты C# получают экземпляр `IGameApi` в качестве аргумента своей точки входа.
*   **Точка входа:** Точкой входа для C# является статический метод `Main` в любом классе внутри файла `.cs` в каталоге `scripts`.

### Пример C# API

```csharp
// scripts/main.cs
using BYOND2.Core.Api;

public class MainScript
{
    public static void Main(IGameApi gameApi)
    {
        // Создать новый объект
        var player = gameApi.ObjectApi.CreateObject("/obj/creature/player");
        player.SetProperty("x", 10);
        player.SetProperty("y", 5);
    }
}
```

## Горячая перезагрузка

Все три системы скриптинга поддерживают горячую перезагрузку. Сервер отслеживает изменения в файлах в каталогах `scripts` и проекта и автоматически перезагружает их. Это позволяет вносить изменения в игровую логику в реальном времени без перезапуска сервера.
