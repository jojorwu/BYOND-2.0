# Руководство по серверу

Это руководство содержит инструкции по запуску сервера BYOND 2.0 и его настройке с помощью файла `server_config.json`.

## Как запустить сервер

Самый простой способ запустить сервер — использовать предоставленный shell-скрипт из корня проекта:

```bash
./run_server.sh
```

Сервер запустится с использованием настроек, определенных в `server_config.json`. Если этот файл не существует, он будет создан со значениями по умолчанию при первом запуске.

## Конфигурация сервера (`server_config.json`)

Поведение сервера можно настроить с помощью файла `server_config.json`. Ниже приведено подробное описание каждой доступной настройки.

### Общие настройки

*   `ServerName` (string): Имя сервера, которое будет отображаться игрокам. По умолчанию: `"BYOND 2.0 Server"`.
*   `ServerDescription` (string): Краткое описание сервера. По умолчанию: `"A default server instance."`.
*   `MaxPlayers` (integer): Максимальное количество игроков, которые могут одновременно подключиться к серверу. По умолчанию: `32`.
*   `EnableVm` (boolean): Включает или отключает DreamVM для запуска DM-скриптов. **Важно:** Этот параметр должен быть установлен в `true` для запуска любой игровой логики на DM. По умолчанию: `true`.
*   `VmMaxInstructions` (integer): Максимальное количество инструкций, которое может выполнить один поток ВМ перед приостановкой. Это защита от бесконечных циклов. По умолчанию: `1000000`.
*   `PlayerObjectTypePath` (string): Путь к типу объекта игрока, который автоматически создается при подключении нового клиента. По умолчанию: `"/obj/player"`.

### Сетевые настройки (`Network`)

*   `Mode` (string): В настоящее время не используется. Зарезервировано для будущих сетевых моделей. По умолчанию: `"Automatic"`.
*   `IpAddress` (string): IP-адрес, к которому будет привязан сервер. По умолчанию: `"127.0.0.1"`.
*   `UdpPort` (integer): UDP-порт для игрового трафика в реальном времени. По умолчанию: `9050`.
*   `ConnectionKey` (string): Секретный ключ, используемый для проверки подключений клиентов. По умолчанию: `"BYOND2.0"`.
*   `DisconnectTimeout` (integer): Время в миллисекундах, в течение которого клиент может не отвечать, прежде чем будет отключен. По умолчанию: `10000`.

### Настройки HTTP-сервера (`HttpServer`)

Этот раздел настраивает встроенный веб-сервер, используемый для раздачи игровых ассетов.

*   `Enabled` (boolean): Включает или отключает HTTP-сервер ассетов. По умолчанию: `true`.
*   `Port` (integer): TCP-порт, который будет прослушивать HTTP-сервер. По умолчанию: `9051`.
*   `AssetsRoot` (string): Путь к каталогу, содержащему ассеты для раздачи. Относительно корня проекта. По умолчанию: `"assets"`.

### Настройки производительности (`Performance`)

*   `TickRate` (integer): Количество игровых тиков в секунду. По умолчанию: `60`.
*   `EnableRegionalProcessing` (boolean): Включает или отключает высокопроизводительную систему [региональной обработки](./regional-processing.md). По умолчанию: `false`.
*   `VmInstructionSlice` (integer): Количество инструкций, которое поток ВМ выполняет за один раз, прежде чем уступить другим потокам. По умолчанию: `100`.
*   `SnapshotBroadcastInterval` (integer): Интервал в миллисекундах, с которым снимки состояния игры отправляются клиентам. По умолчанию: `100`.

#### Настройки региональной обработки (`Performance.RegionalProcessing`)

Эти настройки активны, только если `EnableRegionalProcessing` установлено в `true`.

*   `ActivationRange` (integer): Радиус (в регионах) вокруг игрока, который будет активирован. Значение `1` активирует область 3x3. По умолчанию: `1`.
*   `ZActivationRange` (integer): Количество Z-уровней выше и ниже игрока, которые будут активированы. `0` означает только текущий Z-уровень. По умолчанию: `0`.
*   `EnableRegionMerging` (boolean): Включает или отключает слияние смежных активных регионов для более эффективной обработки. По умолчанию: `false`.
*   `MinRegionsToMerge` (integer): Минимальное количество смежных активных регионов, необходимое для формирования объединенной группы. По умолчанию: `2`.

#### Бюджетирование времени (`Performance.TimeBudgeting.ScriptHost`)

*   `Enabled` (boolean): Включает или отключает бюджетирование времени для хоста скриптов. По умолчанию: `true`.
*   `BudgetPercent` (float): Процент времени каждого тика (от 0.0 до 1.0), который может быть использован для выполнения скриптов. По умолчанию: `0.5` (50%).

### Настройки для разработки (`Development`)

*   `ScriptReloadDebounceMs` (integer): Задержка в миллисекундах перед перезагрузкой скриптов после обнаружения изменения в файле. Это предотвращает многократные перезагрузки, происходящие подряд. По умолчанию: `200`.
