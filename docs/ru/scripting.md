# Скриптинг

Игровой движок BYOND 2.0 поддерживает как Lua, так и C# для написания скриптов. Это позволяет разработчикам выбирать лучший инструмент для задачи, будь то простота и динамичность Lua или производительность и строгая типизация C#.

## Движок Lua

Интеграция с Lua осуществляется с помощью библиотеки NLua, которая обеспечивает связь между C# и Lua. Это позволяет вызывать функции C# из Lua и наоборот.

### Пример Lua API

Вот пример того, как взаимодействовать с игровым API из скрипта Lua:

```lua
-- scripts/main.lua
local mapApi = global.GameApi.MapApi
local objectApi = global.GameApi.ObjectApi

-- Загрузить карту
mapApi:LoadMap("maps/example.dmm")

-- Создать новый объект
local player = objectApi:CreateObject("/obj/creature/player")
player:SetProperty("x", 10)
player:SetProperty("y", 5)
```

## Движок C#

Скриптинг на C# поддерживается с помощью Roslyn, что позволяет компилировать код C# "на лету". Это предоставляет мощный способ расширения движка с помощью высокопроизводительного, статически типизированного кода.

### Пример C# API

Вот тот же пример, но реализованный в виде скрипта C#:

```csharp
// scripts/main.cs
using BYOND2.Core.Api;

public class MainScript
{
    public static void Main(IGameApi gameApi)
    {
        // Загрузить карту
        gameApi.MapApi.LoadMap("maps/example.dmm");

        // Создать новый объект
        var player = gameApi.ObjectApi.CreateObject("/obj/creature/player");
        player.SetProperty("x", 10);
        player.SetProperty("y", 5);
    }
}
```

## Горячая перезагрузка

Одной из ключевых особенностей движка является горячая перезагрузка скриптов. Сервер отслеживает изменения в файлах в каталоге `scripts` и автоматически перезагружает их при обнаружении изменений. Это значительно ускоряет процесс разработки, так как изменения в игровой логике можно увидеть в реальном времени без перезапуска сервера.

Механизм горячей перезагрузки реализован с использованием `FileSystemWatcher` и имеет защиту от многократных срабатываний (debouncing) с помощью `System.Threading.Timer`. Эта функция работает как для Lua, так и для C# скриптов.

## Точки входа

Основной точкой входа для скриптов Lua является файл `scripts/main.lua`. Для скриптов C# точкой входа является статический метод `Main` в классе внутри файла `.cs` в каталоге `scripts`. При запуске сервера или после горячей перезагрузки эти точки входа выполняются. В них должна находиться основная логика инициализации игрового мира и другие важные компоненты.
