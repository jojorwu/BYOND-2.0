# Руководство по серверу

Это руководство содержит инструкции по запуску сервера BYOND 2.0 и его настройке с помощью файла `server_config.json`.

## Как запустить сервер

Для запуска игрового сервера выполните следующую команду из корня проекта:

```bash
dotnet run --project Server/Server.csproj
```

Сервер запустится с использованием настроек, определенных в `server_config.json`. Если этот файл не существует, он будет создан со значениями по умолчанию.

## Конфигурация сервера (`server_config.json`)

Поведение сервера можно настроить с помощью файла `server_config.json`. Ниже приведено подробное описание каждой доступной настройки.

### Общие настройки

*   `ServerName` (string): Имя сервера, которое будет отображаться игрокам. По умолчанию: `"BYOND 2.0 Server"`.
*   `ServerDescription` (string): Краткое описание сервера. По умолчанию: `"A default server instance."`.
*   `MaxPlayers` (integer): Максимальное количество игроков, которые могут одновременно подключиться к серверу. По умолчанию: `32`.
*   `EnableVm` (boolean): Включает или отключает DreamVM для запуска DM-скриптов. По умолчанию: `false`.
*   `VmMaxInstructions` (integer): Максимальное количество инструкций, которое может выполнить один поток ВМ перед приостановкой. Это защита от бесконечных циклов. По умолчанию: `1000000`.

### Сетевые настройки (`Network`)

*   `Mode` (string): Режим сети. Может быть `Automatic` или `Manual`. По умолчанию: `Automatic`.
*   `IpAddress` (string): IP-адрес, к которому будет привязан сервер. По умолчанию: `"127.0.0.1"`.
*   `UdpPort` (integer): UDP-порт, который будет прослушивать сервер. По умолчанию: `9050`.
*   `ConnectionKey` (string): Секретный ключ, используемый для проверки подключений клиентов. По умолчанию: `"BYOND2.0"`.
*   `DisconnectTimeout` (integer): Время в миллисекундах, в течение которого клиент может не отвечать, прежде чем будет отключен. По умолчанию: `10000`.

### Настройки потоков (`Threading`)

*   `Mode` (string): Режим потоков. Может быть `Automatic` или `Manual`. По умолчанию: `Automatic`.
*   `ThreadCount` (integer): Количество потоков, используемых сервером. Если установлено значение `0`, количество потоков будет определено автоматически в зависимости от возможностей системы. По умолчанию: `0`.

### Настройки производительности (`Performance`)

*   `TickRate` (integer): Количество игровых тиков в секунду. По умолчанию: `60`.
*   `VmInstructionSlice` (integer): Количество инструкций, которое поток ВМ выполняет за один раз, прежде чем уступить другим потокам. По умолчанию: `100`.
*   `SnapshotBroadcastInterval` (integer): Интервал в миллисекундах, с которым снимки состояния игры отправляются клиентам. По умолчанию: `100`.

*   `EnableRegionalProcessing` (boolean): Включает или отключает региональную обработку. Когда включено, сервер обрабатывает только те регионы карты, которые активны (рядом с игроками), что значительно повышает производительность в больших мирах. По умолчанию: `false`.

#### Региональная обработка (`Performance.RegionalProcessing`)

Эти настройки активны, только если `EnableRegionalProcessing` установлено в `true`.

*   `RegionSize` (integer): Размер одного региона в чанках. Например, значение 8 означает, что каждый регион имеет размер 8x8 чанков. По умолчанию: `8`.
*   `MaxThreads` (integer): Максимальное количество потоков для параллельной обработки регионов. Если установлено значение `0`, количество потоков будет определено автоматически. По умолчанию: `0`.
*   `ActivationRange` (integer): Расстояние в регионах вокруг игрока, которое считается "активным". Например, значение 1 означает, что активна сетка регионов 3x3 вокруг игрока. По умолчанию: `1`.
*   `ZActivationRange` (integer): Диапазон активации для Z-уровней (высоты). Значение 0 означает, что активируется только текущий Z-уровень игрока. Значение 1 активирует также уровень выше и ниже. По умолчанию: `0`.
*   `EnableRegionMerging` (boolean): Включает объединение смежных активных регионов в единый блок обработки, что может повысить производительность за счет снижения накладных расходов. По умолчанию: `false`.
*   `MinRegionsToMerge` (integer): Минимальное количество смежных активных регионов, необходимое для формирования объединенного региона. По умолчанию: `2`.
*   `ScriptActiveRegionTimeout` (integer): Время в секундах, в течение которого регион, активированный скриптом (а не игроком), останется активным, прежде чем будет автоматически деактивирован. По умолчанию: `60`.

#### Бюджетирование времени (`TimeBudgeting.ScriptHost`)

*   `Enabled` (boolean): Включает или отключает бюджетирование времени для хоста скриптов. По умолчанию: `true`.
*   `BudgetPercent` (float): Процент времени каждого тика, который может быть использован для выполнения скриптов. Например, значение `0.5` означает 50% времени тика. По умолчанию: `0.5`.

### Настройки для разработки (`Development`)

*   `ScriptReloadDebounceMs` (integer): Задержка в миллисекундах перед перезагрузкой скриптов после обнаружения изменения в файле. Это предотвращает многократные перезагрузки, происходящие подряд. По умолчанию: `200`.
